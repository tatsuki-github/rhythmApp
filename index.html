<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>リズムトレーニング</title>
<script>
      document.write(
        '<link rel="stylesheet" href="css/style.css?' + new Date().getTime() + '">'
      );
      /*
      document.write(
        '<script src="js/script.js?' + new Date().getTime() + '"><\/script>'
      );
      */
</script>
</head>

<body>

<div class="rhythmImg">
  <div>
    <img src="img/rhythm1.png" alt="" id="rhythm-0">
    <p>①</p>
  </div>
  <div>
    <img src="img/rhythm2.png" alt="" id="rhythm-1">
    <p>②</p>
  </div>
  <div>
    <img src="img/rhythm3.png" alt="" id="rhythm-2">
    <p>③</p>
  </div>
</div>
<div class="rhythmImg">
  <div>
    <img src="img/rhythm4.png" alt="" id="rhythm-3">
    <p>④</p>
  </div>
  <div>
    <img src="img/rhythm5.png" alt="" id="rhythm-4">
    <p>⑤</p>
  </div>
  <div>
    <img src="img/rhythm6.png" alt="" id="rhythm-5">
    <p>⑥</p>
  </div>
</div>

<div class="part">
    <div class="item" id="first">
      <select id="rhythm_0" class="rhythm">
        <option value="rhythm0" selected>①</option>
        <option value="rhythm1">②</option>
        <option value="rhythm2">③</option>
        <option value="rhythm3">④</option>
        <option value="rhythm4">⑤</option>
        <option value="rhythm5">⑥</option>
      </select>
      <div class="beat">
        <p>1</p>
        <select id="rhythm0" class="rhythm">
          <option value="off" selected></option>
          <option value="on">◯</option>
        </select>
    </div>
    <div class="beat">
      <p>2</p>
      <select id="rhythm1" class="rhythm">
        <option value="off" selected></option>
        <option value="on">◯</option>
      </select>
    </div>
    <div class="beat">
      <p>3</p>
      <select id="rhythm2" class="rhythm">
        <option value="off" selected></option>
        <option value="on">◯</option>
      </select>
    </div>
    <div class="beat">
      <p>4</p>
      <select id="rhythm3" class="rhythm">
        <option value="off" selected></option>
        <option value="on">◯</option>
      </select>
    </div>
    <div class="beat">
      <p>5</p>
      <select id="rhythm4" class="rhythm">
        <option value="off" selected></option>
        <option value="on">◯</option>
      </select> 
    </div>
    <div class="beat">
      <p>6</p>
      <select id="rhythm5" class="rhythm">
        <option value="off" selected></option>
        <option value="on">◯</option>
      </select>
    </div>
    <div class="beat">
      <p>7</p>
      <select  id="rhythm6" class="rhythm">
        <option value="off" selected></option>
        <option value="on">◯</option>
      </select>
    </div>
    <div class="beat">
      <p>8</p>
      <select  id="rhythm7" class="rhythm">
        <option value="off" selected></option>
        <option value="on">◯</option>
      </select>
    </div>   
      <div class="beat">
        <p>9</p>
        <select  id="rhythm8" class="rhythm">
          <option value="off" selected></option>
          <option value="on">◯</option>
        </select>
      </div>
      <div class="beat">
        <p>10</p>
        <select  id="rhythm9" class="rhythm">
          <option value="off" selected></option>
          <option value="on">◯</option>
        </select>
      </div>
      <div class="beat">
        <p>11</p>
        <select  id="rhythm10" class="rhythm">
          <option value="off" selected></option>
          <option value="on">◯</option>
        </select>
      </div>
      <img src="img/rhythm7.png" alt="" width="12%">
    </div>
</div>

<div class="part">
  <div class="item" id="second">
    <select id="rhythm_1" class="rhythm">
      <option value="rhythm0" selected>①</option>
      <option value="rhythm1">②</option>
      <option value="rhythm2">③</option>
      <option value="rhythm3">④</option>
      <option value="rhythm4">⑤</option>
      <option value="rhythm5">⑥</option>
    </select>
    <div class="beat">
      <p>1</p>
      <select  id="rhythm11" class="rhythm">
        <option value="off" selected></option>
        <option value="on">△</option>
      </select>
  </div>
  <div class="beat">
    <p>2</p>
    <select  id="rhythm12" class="rhythm">
      <option value="off" selected></option>
      <option value="on">△</option>
    </select>
  </div>
  <div class="beat">
    <p>3</p>
    <select  id="rhythm13" class="rhythm">
      <option value="off" selected></option>
      <option value="on">△</option>
    </select>
  </div>
  <div class="beat">
    <p>4</p>
    <select  id="rhythm14" class="rhythm">
      <option value="off" selected></option>
      <option value="on">△</option>
    </select>
  </div>
  <div class="beat">
    <p>5</p>
    <select  id="rhythm15" class="rhythm">
      <option value="off" selected></option>
      <option value="on">△</option>
    </select>
  </div>
  <div class="beat">
    <p>6</p>
    <select  id="rhythm16" class="rhythm">
      <option value="off" selected></option>
      <option value="on">△</option>
    </select>
  </div>
  <div class="beat">
    <p>7</p>
    <select  id="rhythm17" class="rhythm">
      <option value="off" selected></option>
      <option value="on">△</option>
    </select>
  </div>
  <div class="beat">
    <p>8</p>
    <select  id="rhythm18" class="rhythm">
      <option value="off" selected></option>
      <option value="on">△</option>
    </select>
  </div>
    <div class="beat">
      <p>9</p>
      <select  id="rhythm19" class="rhythm">
        <option value="off" selected></option>
        <option value="on">△</option>
      </select>
    </div>
    <div class="beat">
      <p>10</p>
      <select  id="rhythm20" class="rhythm">
        <option value="off" selected></option>
        <option value="on">△</option>
      </select>
    </div>
    <div class="beat">
      <p>11</p>
      <select  id="rhythm21" class="rhythm">
        <option value="off" selected></option>
        <option value="on">△</option>
      </select>
    </div>
    <img src="img/rhythm7.png" alt="" width="12%">
  </div>
</div>

<div class="part">
  <div class="item" id="third">
    <select id="rhythm_2" class="rhythm">
      <option value="rhythm0" selected>①</option>
      <option value="rhythm1">②</option>
      <option value="rhythm2">③</option>
      <option value="rhythm3">④</option>
      <option value="rhythm4">⑤</option>
      <option value="rhythm5">⑥</option>
    </select>
    <div class="beat">
      <p>1</p>
      <select  id="rhythm22" class="rhythm">
        <option value="off" selected></option>
        <option value="on">□</option>
      </select>
  </div>
  <div class="beat">
    <p>2</p>
    <select  id="rhythm23" class="rhythm">
      <option value="off" selected></option>
      <option value="on">□</option>
    </select>
  </div>
  <div class="beat">
    <p>3</p>
    <select  id="rhythm24" class="rhythm">
      <option value="off" selected></option>
      <option value="on">□</option>
    </select>
  </div>
  <div class="beat">
    <p>4</p>
    <select  id="rhythm25" class="rhythm">
      <option value="off" selected></option>
      <option value="on">□</option>
    </select>
  </div>
  <div class="beat">
    <p>5</p>
    <select  id="rhythm26" class="rhythm">
      <option value="off" selected></option>
      <option value="on">□</option>
    </select>
  </div>
  <div class="beat">
    <p>6</p>
    <select  id="rhythm27" class="rhythm">
      <option value="off" selected></option>
      <option value="on">□</option>
    </select>
  </div>
  <div class="beat">
    <p>7</p>
    <select  id="rhythm28" class="rhythm">
      <option value="off" selected></option>
      <option value="on">□</option>
    </select>
  </div>
  <div class="beat">
    <p>8</p>
    <select  id="rhythm29" class="rhythm">
      <option value="off" selected></option>
      <option value="on">□</option>
    </select>
  </div> 
    <div class="beat">
      <p>9</p>
      <select  id="rhythm30" class="rhythm">
        <option value="off" selected></option>
        <option value="on">□</option>
      </select>
    </div>
    <div class="beat">
      <p>10</p>
      <select  id="rhythm31" class="rhythm">
        <option value="off" selected></option>
        <option value="on">□</option>
      </select>
    </div>
    <div class="beat">
      <p>11</p>
      <select  id="rhythm32" class="rhythm">
        <option value="off" selected></option>
        <option value="on">□</option>
      </select>
    </div>
    <img src="img/rhythm7.png" alt="" width="12%">
  </div>
</div>

<div class="part">
  <div class="item" id="forth">
    <select id="rhythm_3" class="rhythm">
      <option value="rhythm0" selected>①</option>
      <option value="rhythm1">②</option>
      <option value="rhythm2">③</option>
      <option value="rhythm3">④</option>
      <option value="rhythm4">⑤</option>
      <option value="rhythm5">⑥</option>
    </select>
    <div class="beat">
      <p>1</p>
      <select  id="rhythm33" class="rhythm">
        <option value="off" selected></option>
        <option value="on">☆</option>
      </select>
  </div>
  <div class="beat">
    <p>2</p>
    <select  id="rhythm34" class="rhythm">
      <option value="off" selected></option>
      <option value="on">☆</option>
    </select>
  </div>
  <div class="beat">
    <p>3</p>
    <select  id="rhythm35" class="rhythm">
      <option value="off" selected></option>
      <option value="on">☆</option>
    </select>
  </div>
  <div class="beat">
    <p>4</p>
    <select  id="rhythm36" class="rhythm">
      <option value="off" selected></option>
      <option value="on">☆</option>
    </select>
  </div>
  <div class="beat">
    <p>5</p>
    <select  id="rhythm37" class="rhythm">
      <option value="off" selected></option>
      <option value="on">☆</option>
    </select>
  </div>
  <div class="beat">
    <p>6</p>
    <select  id="rhythm38" class="rhythm">
      <option value="off" selected></option>
      <option value="on">☆</option>
    </select>
  </div>
  <div class="beat">
    <p>7</p>
    <select  id="rhythm39" class="rhythm">
      <option value="off" selected></option>
      <option value="on">☆</option>
    </select>
  </div>
  <div class="beat">
    <p>8</p>
    <select  id="rhythm40" class="rhythm">
      <option value="off" selected></option>
      <option value="on">☆</option>
    </select>
  </div>   
    <div class="beat">
      <p>9</p>
      <select  id="rhythm41" class="rhythm">
        <option value="off" selected></option>
        <option value="on">☆</option>
      </select>
    </div>
    <div class="beat">
      <p>10</p>
      <select  id="rhythm42" class="rhythm">
        <option value="off" selected></option>
        <option value="on">☆</option>
      </select>
    </div>
    <div class="beat">
      <p>11</p>
      <select  id="rhythm43" class="rhythm">
        <option value="off" selected></option>
        <option value="on">☆</option>
      </select>
    </div>
    <img src="img/rhythm7.png" alt="" width="12%">
  </div>
</div>

<div class="buttons">
  <div class="tempo_and_piano">
    <select name="tempo_category" id="tempo_category">
      <option value="tempo75">&#9833; = 75</option>
      <option value="tempo95" selected>&#9833; = 95</option>
      <option value="tempo115">&#9833; = 115</option>
    </select>
  </div>
  <select name="play_mode" id="play_mode">
    <option value="3personMode" selected>3人再生モード</option>
    <option value="4personMode">4人再生モード</option>
    <option value="1personMode1">１人目再生モード</option>
    <option value="1personMode2">２人目再生モード</option>
    <option value="1personMode3">３人目再生モード</option>
    <option value="1personMode4">４人目再生モード</option>
  </select>
  <button id = "play"></button>
  <button id = "stop"></button>
</div>

<script>
window.addEventListener("load", function(){
  display();
}, false)

document.getElementById("play").addEventListener("click", function() {
    playMode();
}, false);

document.getElementById("stop").addEventListener("click", function() {
    Refresh();
}, false);


    const tempo_category = document.getElementById("tempo_category");
    tempo_category.onchange = Refresh;

    const rhythmCategory = [rhythm0,rhythm1,rhythm2,rhythm3,rhythm4,rhythm5,rhythm6,rhythm7,rhythm8,rhythm9,rhythm10,rhythm11,rhythm12,rhythm13,rhythm14,rhythm15,rhythm16,rhythm17,rhythm18,rhythm19,rhythm20,rhythm21,rhythm22,rhythm23,rhythm24,rhythm25,rhythm26,rhythm27,rhythm28,rhythm29,rhythm30,rhythm31,rhythm32,rhythm33,rhythm34,rhythm35,rhythm36,rhythm37,rhythm38,rhythm39,rhythm40,rhythm41,rhythm42,rhythm43];

    const selectRhythmCategory = [rhythm_0,rhythm_1,rhythm_2,rhythm_3];

    const play_mode = document.getElementById("play_mode");
    play_mode.onchange = Refresh;
    play_mode.onchange = changeDisplay;

    const first = document.getElementById("first");
    const second = document.getElementById("second");
    const third = document.getElementById("third");
    const forth = document.getElementById("forth");



function Refresh(){
  Tone.Transport.stop();
  Tone.Transport.cancel();
}

const rhythmLists = [
[{time: "0:0", duration: "2n"},{time: "0:2", duration: "2n"},{time: "1:0", duration: "1m"}],
[{time: "0:1", duration: "4n"},{time: "0:3", duration: "4n"},{time: "1:1", duration: "4n"},{time: "1:3", duration: "4n"}],
[{time: "0:0", duration: "4n"},{time: "0:1", duration: "8n"},{time: "0:1.5", duration: "8n"},{time: "0:2", duration: "4n"},{time: "1:0", duration: "4n"},{time: "1:1", duration: "8n"},{time: "1:1.5", duration: "8n"},{time: "1:2", duration: "4n"}],
[{time: "0:0", duration: "8n"},{time: "0:0.5", duration: "8n"},{time: "0:1", duration: "8n"},{time: "0:1.5", duration: "8n"},{time: "0:2", duration: "8n"},{time: "0:2.5", duration: "8n"},{time: "0:3", duration: "8n"},{time: "0:3.5", duration: "8n"},{time: "1:0", duration: "8n"},{time: "1:0.5", duration: "8n"},{time: "1:1", duration: "8n"},{time: "1:1.5", duration: "8n"},{time: "1:2", duration: "8n"},{time: "1:2.5", duration: "8n"},{time: "1:3", duration: "8n"},{time: "1:3.5", duration: "8n"}],
[{time: "0:0", duration: "3n"},{time: "0:1.5", duration: "8n"},{time: "0:2", duration: "4n"},{time: "1:0", duration: "3n"},{time: "1:1.5", duration: "8n"},{time: "1:2", duration: "4n"}],
[{time: "0:0", duration: "3n"},{time: "0:1.5", duration: "8n"},{time: "0:2", duration: "4n"},{time: "0:3", duration: "4n"},{time: "1:1", duration: "4n"},{time: "1:2", duration: "4n"}],
[{time: "0:0", duration: "4n"}]
];

  document.getElementById(`rhythm-0`).addEventListener("click", function() {
  changeTempo();
  const synth = new Tone.Synth().toDestination();
  function setPlay(time, note) {synth.triggerAttackRelease("E4", note.duration, time);}
  const melody = new Tone.Part(setPlay, rhythmLists[0]).start();
  Tone.Transport.start();
}, false);

document.getElementById("rhythm-1").addEventListener("click", function() {
  changeTempo();
  const synth = new Tone.Synth().toDestination();
  function setPlay(time, note) {synth.triggerAttackRelease("E4", note.duration, time);}
  const melody = new Tone.Part(setPlay, rhythmLists[1]).start();
  Tone.Transport.start();
}, false);

document.getElementById("rhythm-2").addEventListener("click", function() {
  changeTempo();
  const synth = new Tone.Synth().toDestination();
  function setPlay(time, note) {synth.triggerAttackRelease("E4", note.duration, time);}
  const melody = new Tone.Part(setPlay, rhythmLists[2]).start();
  Tone.Transport.start();
}, false);

document.getElementById("rhythm-3").addEventListener("click", function() {
  changeTempo();
  const synth = new Tone.Synth().toDestination();
  function setPlay(time, note) {synth.triggerAttackRelease("E4", note.duration, time);}
  const melody = new Tone.Part(setPlay, rhythmLists[3]).start();
  Tone.Transport.start();
}, false);

document.getElementById("rhythm-4").addEventListener("click", function() {
  changeTempo();
  const synth = new Tone.Synth().toDestination();
  function setPlay(time, note) {synth.triggerAttackRelease("E4", note.duration, time);}
  const melody = new Tone.Part(setPlay, rhythmLists[4]).start();
  Tone.Transport.start();
}, false);

document.getElementById("rhythm-5").addEventListener("click", function() {
  changeTempo();
  const synth = new Tone.Synth().toDestination();
  function setPlay(time, note) {synth.triggerAttackRelease("E4", note.duration, time);}
  const melody = new Tone.Part(setPlay, rhythmLists[5]).start();
  Tone.Transport.start();
}, false);


function playMode(){
  changeTempo();
  changeRhythm();
  Tone.Transport.start();

  switch (play_mode.value){
    case "3personMode":
      melody1();
      melody2();
      melody3();
        break;
    case "4personMode":
      melody1();
      melody2();
      melody3();
      melody4();
        break;
    case "1personMode1":
      melody1();
        break;
    case "1personMode2":
      melody2();
        break;
    case "1personMode3":
      melody3();
        break;
    case "1personMode4":
      melody4();
        break;
    default:
  }  
}

function changeTempo(){
    switch (tempo_category.value){
    case "tempo75":
    Tone.Transport.bpm.value = 75;
        break;
    case "tempo95":
    Tone.Transport.bpm.value = 95;
        break;
    case "tempo115":
    Tone.Transport.bpm.value = 115;
        break;
    default:  
    Tone.Transport.bpm.value = 95;
  }  
}

function changeDisplay(){
  switch (play_mode.value){
    case "3personMode":
    allDisplayVisible();
    forth.style.visibility = "hidden";
        break;
    case "4personMode":
    allDisplayVisible();
        break;
    case "1personMode1":
    allDisplayHidden();
    first.style.visibility = "visible";
        break;
    case "1personMode2":
    allDisplayHidden();
    second.style.visibility = "visible";
        break;
    case "1personMode3":
    allDisplayHidden();
    third.style.visibility = "visible";
        break;
    case "1personMode4":
    allDisplayHidden();
    forth.style.visibility = "visible";
        break;
    default:
  }  
}

function allDisplayVisible(){
  first.style.visibility = "visible";
  second.style.visibility = "visible";
  third.style.visibility = "visible";
  forth.style.visibility = "visible";  
}

function allDisplayHidden(){
  first.style.visibility = "hidden";
  second.style.visibility = "hidden";
  third.style.visibility = "hidden";
  forth.style.visibility = "hidden";
}

function display(){
  allDisplayVisible();
  forth.style.visibility = "hidden";
}

const melodyList = new Array(4);

for(i = 0; i < 44; i++){
  rhythmCategory[i] = document.getElementById(`rhythm${i}`);
}

for(i = 0; i < selectRhythmCategory.length; i++){
  selectRhythmCategory[i] = document.getElementById(`rhythm_${i}`);
}

function changeRhythm(){
  for(i = 0; i < selectRhythmCategory.length; i++){
    switch (selectRhythmCategory[i].value){
        case "rhythm0":
          melodyList[i] = rhythmLists[0];
        break;
        case "rhythm1":
          melodyList[i] = rhythmLists[1];
        break;
        case "rhythm2":
          melodyList[i] = rhythmLists[2];
        break;
        case "rhythm3":
          melodyList[i] = rhythmLists[3];
        break;
        case "rhythm4":
          melodyList[i] = rhythmLists[4];
        break;
        case "rhythm5":
          melodyList[i] = rhythmLists[5];
        break;
        default:  
    }  
  }
}

for(i = 0; i < 44; i++){
  rhythmCategory[i].onchange = colorChange;
}

function colorChange(){
  for(i = 0; i < 11; i++){
  if(rhythmCategory[i].value == "on"){
    rhythmCategory[i].style.backgroundColor = "lightcoral"
  }
  else{
    rhythmCategory[i].style.backgroundColor = "white"
  }
}
for(i = 11; i < 22; i++){
  if(rhythmCategory[i].value == "on"){
    rhythmCategory[i].style.backgroundColor = "lightskyblue"
  }
  else{
    rhythmCategory[i].style.backgroundColor = "white"
  }
}
for(i = 22; i < 33; i++){
  if(rhythmCategory[i].value == "on"){
    rhythmCategory[i].style.backgroundColor = "yellow"
  }
  else{
    rhythmCategory[i].style.backgroundColor = "white"
  }
}
for(i = 33; i < 44; i++){
  if(rhythmCategory[i].value == "on"){
    rhythmCategory[i].style.backgroundColor = "lightgreen"
  }
  else{
    rhythmCategory[i].style.backgroundColor = "white"
  }
}
}

function melody1(){
  const synth = new Tone.Synth().toDestination();
  function setPlay(time, note) {synth.triggerAttackRelease("E4", note.duration, time, 2.5);}
  const melodies = new Array(11); 
  for(i = 0; i < melodies.length; i++){
    if(rhythmCategory[i].value == "on"){
    melodies[i] = new Tone.Part(setPlay, melodyList[0]).start(`${2*i}m`);
  }
}
  const lastRhythm = new Tone.Part(setPlay, rhythmLists[6]).start("22m");
}

function melody2(){
  const synth = new Tone.Synth().toDestination();
  function setPlay(time, note) {synth.triggerAttackRelease("G4", note.duration, time, 2.5);}
  const melodies = new Array(11); 
  for(i = 0; i < melodies.length; i++){
    if(rhythmCategory[i+11].value == "on"){
    melodies[i] = new Tone.Part(setPlay, melodyList[1]).start(`${2*i}m`);
  }
}
  const lastRhythm = new Tone.Part(setPlay, rhythmLists[6]).start("22m");
}


function melody3(){
  const synth = new Tone.MetalSynth().toDestination();
  function setPlay(time, note) {synth.triggerAttackRelease("E4", note.duration, time);}
  const melodies = new Array(11); 
  for(i = 0; i < melodies.length; i++){
    if(rhythmCategory[i+22].value == "on"){
    melodies[i] = new Tone.Part(setPlay, melodyList[2]).start(`${2*i}m`);
  }
}
  const lastRhythm = new Tone.Part(setPlay, rhythmLists[6]).start("22m");
}

function melody4(){
  const synth = new Tone.MembraneSynth().toDestination();
  function setPlay(time, note) {synth.triggerAttackRelease("E4", note.duration, time);}
  const melodies = new Array(11); 
  for(i = 0; i < melodies.length; i++){
    if(rhythmCategory[i+33].value == "on"){
    melodies[i] = new Tone.Part(setPlay, melodyList[3]).start(`${2*i}m`);
  }
}
  const lastRhythm = new Tone.Part(setPlay, rhythmLists[6]).start("22m");
}

</script>
<script src="https://unpkg.com/tone@14.7.77/build/Tone.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="js/abcjs-basic-min.js"></script>
</body>
</html>
